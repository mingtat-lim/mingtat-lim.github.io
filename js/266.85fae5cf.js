"use strict";(globalThis["webpackChunkqr_generator"]=globalThis["webpackChunkqr_generator"]||[]).push([[266],{2875:(e,t,l)=>{function s(e,t,l){return e?`${t} ${l}`:t}function a(e,t,l,s){return e%2===0?`${t} ${l}`:`${t} ${s}`}l.d(t,{$:()=>s,r:()=>a})},2620:(e,t,l)=>{l.d(t,{HG:()=>i,Px:()=>a,de:()=>s,xB:()=>o});class s{constructor(e){this._settings={isAdmin:!1,globalDebug:!1,homePageDebug:!1,barCodePageDebug:!1,qrCodePageDebug:!1,profilePageDebug:!1,memberPageDebug:!1,eventsPageDebug:!1,scanCodePageDebug:!1,geolocationPageDebug:!1,settingsPageDebug:!1},this.DB_KEY="SETTINGS",this._local=e.localStorage,null===this._local.getItem(this.DB_KEY)&&this._local.set(this.DB_KEY,JSON.stringify(this.getState()));const t=JSON.parse(this._local.getItem(this.DB_KEY)+"");this._settings=Object.assign(Object.assign({},this._settings),t)}saveSettings(){this._local.set(this.DB_KEY,JSON.stringify(this.getState()))}getState(){return this._settings}get isAdmin(){return this._settings.isAdmin}set isAdmin(e){this._settings.isAdmin=e}get globalDebug(){return this._settings.globalDebug}set globalDebug(e){this._settings.globalDebug=e}get eventsPageDebug(){return this._settings.eventsPageDebug}set eventsPageDebug(e){this._settings.eventsPageDebug=e}get barCodePageDebug(){return this._settings.barCodePageDebug}set barCodePageDebug(e){this._settings.barCodePageDebug=e}get geolocationPageDebug(){return this._settings.geolocationPageDebug}set geolocationPageDebug(e){this._settings.geolocationPageDebug=e}get homePageDebug(){return this._settings.homePageDebug}set homePageDebug(e){this._settings.homePageDebug=e}get memberPageDebug(){return this._settings.memberPageDebug}set memberPageDebug(e){this._settings.memberPageDebug=e}get profilePageDebug(){return this._settings.profilePageDebug}set profilePageDebug(e){this._settings.profilePageDebug=e}get qrCodePageDebug(){return this._settings.qrCodePageDebug}set qrCodePageDebug(e){this._settings.qrCodePageDebug=e}get scanCodePageDebug(){return this._settings.scanCodePageDebug}set scanCodePageDebug(e){this._settings.scanCodePageDebug=e}get settingsPageDebug(){return this._settings.settingsPageDebug}set settingsPageDebug(e){this._settings.settingsPageDebug=e}}class a{constructor(e){this.KEY_BARCODE_DB="barcode-db",this._state={title:"条形码数据库",barCodes:[]},this._local=e.localStorage,null===this._local.getItem(this.KEY_BARCODE_DB)&&this._local.set(this.KEY_BARCODE_DB,JSON.stringify(this.getState()));const t=JSON.parse(this._local.getItem(this.KEY_BARCODE_DB)+"");this._state=Object.assign(Object.assign({},this._state),t)}getState(){return this._state}saveData(){this._local.set(this.KEY_BARCODE_DB,JSON.stringify(this.getState()))}get newItem(){return{caption:"",barCode:"",expanded:!1}}addBarCode(e){this._state.barCodes.push(e)}deleteBarCode(e){this._state.barCodes=[...this._state.barCodes.slice(0,e),...this._state.barCodes.slice(e+1)]}get title(){return this._state.title}get barCodes(){return this._state.barCodes}}class i{constructor(){this.title="功能组",this.checkinOptions=[]}addFunctionGroup(){const e={groupName:"",slots:[{slot:"",selected:!1},{slot:"",selected:!1},{slot:"",selected:!1}]};return this.checkinOptions.push(e),e}}class o{constructor(e){this.KEY_BARCODE_DB="events",this._state={events:[]},this._local=e.localStorage,null===this._local.getItem(this.KEY_BARCODE_DB)&&this._local.set(this.KEY_BARCODE_DB,JSON.stringify(this.getState()));const t=JSON.parse(this._local.getItem(this.KEY_BARCODE_DB)+"");this._state.events=t}getState(){return this._state}get stateString(){return JSON.stringify(this.getState())}restoreData(e){const t=JSON.parse(e);this._state=t}resetData(){this._state.events=[]}saveData(){this._local.set(this.KEY_BARCODE_DB,this.stateString)}get newItem(){return{eventId:"",event:"",eventDate:"",startTime:"",endTime:"",location:"",lat:-1,lon:-1,signupOptions:void 0,checkinOptions:void 0,isSignup:!1,isRegister:!1,expanded:!1}}addBarCode(e){this._state.events.push(e)}deleteBarCode(e){this._state.events=[...this._state.events.slice(0,e),...this._state.events.slice(e+1)]}get events(){return this._state.events}getItemById(e){return this.events.find((t=>t.eventId===e))}}},1435:(e,t,l)=>{l.d(t,{Z:()=>u});var s=l(9835),a=l(1265);const i={name:"BarcodeGenerator",props:{value:[String,Number],format:[String],width:[String,Number],height:[String,Number],displayValue:{type:[String,Boolean],default:!0},text:[String,Number],fontOptions:[String],font:[String],textAlign:[String],textPosition:[String],textMargin:[String,Number],fontSize:[String,Number],background:[String],lineColor:[String],margin:[String,Number],marginTop:[String,Number],marginBottom:[String,Number],marginLeft:[String,Number],marginRight:[String,Number],flat:[Boolean],ean128:[String,Boolean],elementTag:{type:String,default:"svg",validator:function(e){return-1!==["canvas","svg","img"].indexOf(e)}}},render(){return(0,s.h)(this.elementTag,{id:["barcodegen"]})},mounted:function(){o.call(this)}};function o(){this.value;var e={format:this.format,width:this.width,height:this.height,displayValue:this.displayValue,text:this.text,fontOptions:this.fontOptions,font:this.font,textAlign:this.textAlign,textPosition:this.textPosition,textMargin:this.textMargin,fontSize:this.fontSize,background:this.background,lineColor:this.lineColor,margin:this.margin,marginTop:this.marginTop,marginBottom:this.marginBottom,marginLeft:this.marginLeft,marginRight:this.marginRight,flat:this.flat,ean128:this.ean128,valid:function(e){e},elementTag:this.elementTag};n(e),a(this.$el,this.value,e)}function n(e){Object.keys(e).forEach((t=>void 0===e[t]?delete e[t]:{}))}const r=i,u=r},266:(e,t,l)=>{l.r(t),l.d(t,{default:()=>W});var s=l(9835),a=l(6970),i=l(499),o=l(2875);const n={class:"col-2"},r={class:"col-2"},u={key:0,class:"col-2"},g=(0,s.aZ)({__name:"FunctionSlot",props:{debug:{type:Boolean,default:!1},index:{},group:{}},setup(e){const t=e,l=(0,i.iH)(t.group);return(e,g)=>{const c=(0,s.up)("q-checkbox");return(0,s.wg)(),(0,s.iD)(s.HY,null,[(0,s._)("div",{class:(0,a.C_)((0,i.SU)(o.r)(t.index,"row items-center","bg-blue-2","bg-green-2"))},[(0,s._)("div",{class:(0,a.C_)((0,i.SU)(o.$)(e.debug,"col-6","bg-green-2"))},(0,a.zw)(l.value.groupName),3),(0,s._)("div",n,[(0,s._)("div",{class:(0,a.C_)((0,i.SU)(o.$)(e.debug,"row items-center","bg-yellow-2"))},[(0,s._)("div",null,[(0,s.Wm)(c,{modelValue:l.value.slots[0].selected,"onUpdate:modelValue":g[0]||(g[0]=e=>l.value.slots[0].selected=e)},null,8,["modelValue"])]),(0,s._)("div",{class:(0,a.C_)((0,i.SU)(o.$)(e.debug,"","bg-green-2"))},(0,a.zw)(l.value.slots[0].slot),3)],2)]),(0,s._)("div",r,[(0,s._)("div",{class:(0,a.C_)((0,i.SU)(o.$)(e.debug,"row items-center","bg-blue-2"))},[(0,s._)("div",null,[(0,s.Wm)(c,{modelValue:l.value.slots[1].selected,"onUpdate:modelValue":g[1]||(g[1]=e=>l.value.slots[1].selected=e)},null,8,["modelValue"])]),(0,s._)("div",null,(0,a.zw)(l.value.slots[1].slot),1)],2)]),""!==l.value.slots[2].slot?((0,s.wg)(),(0,s.iD)("div",u,[(0,s._)("div",{class:(0,a.C_)((0,i.SU)(o.$)(e.debug,"row items-center","bg-yellow-2"))},[(0,s._)("div",null,[(0,s.Wm)(c,{modelValue:l.value.slots[2].selected,"onUpdate:modelValue":g[2]||(g[2]=e=>l.value.slots[2].selected=e)},null,8,["modelValue"])]),(0,s._)("div",null,(0,a.zw)(l.value.slots[1].slot),1)],2)])):(0,s.kq)("",!0)],2),(e.debug,(0,s.kq)("",!0))],64)}}});var c=l(1221),d=l(9984),v=l.n(d);const h=g,b=h;v()(g,"components",{QCheckbox:c.Z});var m=l(6009),_=l(1435),S=l(9302),p=l(2620),D=l(2988),f=l(3529),w=function(e,t,l,s){function a(e){return e instanceof l?e:new l((function(t){t(e)}))}return new(l||(l=Promise))((function(l,i){function o(e){try{r(s.next(e))}catch(t){i(t)}}function n(e){try{r(s["throw"](e))}catch(t){i(t)}}function r(e){e.done?l(e.value):a(e.value).then(o,n)}r((s=s.apply(e,t||[])).next())}))};const C={class:"col item-stretch"},U={key:0,class:"error"},k={class:"row text-center"},y={class:"col items-center",style:{width:"300px",height:"300px"}},P={key:1},O={key:0},x={class:"col text-center"},B={key:2},E={key:0,class:"decode-result"},q={key:1,class:"decode-result"},N={key:2,class:"decode-result"},V={key:3,class:"decode-result"},$={key:4},H={key:5},I="profile",T=(0,s.aZ)({__name:"BarCode",setup(e){const t=(0,i.iH)();function l(){f.b.getCurrentPosition({timeout:2e4}).then((e=>{h&&console.log("Current...",e),t.value=e}))}let n;function r(e,t,l,s){return g(e,t,l,s)}function u(e){return e*Math.PI/180}function g(e,t,l,s){var a=6371,i=u(l-e),o=u(s-t);e=u(e),l=u(l);var n=Math.sin(i/2)*Math.sin(i/2)+Math.sin(o/2)*Math.sin(o/2)*Math.cos(e)*Math.cos(l),r=2*Math.atan2(Math.sqrt(n),Math.sqrt(1-n));return a*r}(0,s.bv)((()=>w(this,void 0,void 0,(function*(){l(),n=yield f.b.watchPosition({},((e,l)=>{h&&console.log("New GPS position",l),t.value=e}))})))),(0,s.Jd)((()=>{f.b.clearWatch({id:n})}));const c=(0,S.Z)(),d=new p.de(c),v=(0,i.iH)(new p.xB(c)),h=d.globalDebug||d.barCodePageDebug,T=(0,i.iH)(JSON.parse(c.localStorage.getItem(I)+""));null===T.value&&(T.value={volunteerNo:"",name:"",phoneNo:"",email:"",expanded:!1});const A=(0,i.iH)("off"),z=(0,i.iH)(),Y=(0,i.iH)(),K=(0,i.iH)(),W=(0,i.iH)(),J=(0,i.iH)(),R=(0,i.iH)(),M=(0,i.iH)(),j=(0,i.iH)();let L,Z;function G(e){h&&console.log("onDetect",e);const l=e,[s]=l;let a;if(h&&console.log(s.rawValue),s.rawValue.startsWith("{")){const e=JSON.parse(s.rawValue);J.value=e.eventId,W.value=e.event,R.value=e.location,M.value=e.lat,j.value=e.lon,"object"===typeof t.value&&t.value&&(K.value=r(M.value,j.value,t.value.coords.latitude,t.value.coords.longitude)),L=v.value.getItemById(e.eventId),a=JSON.stringify(e)}else a=s.rawValue;Y.value=a,oe(),X.value=D.ou.now().toISO(),ie()}function Q(){c.notify({message:`${T.value.name} 签到成功!`,color:"green-6"}),Y.value=void 0}function F(){Y.value=void 0}const X=(0,i.iH)(),ee=(0,i.iH)(),te=(0,i.iH)();function le(){clearTimeout(Z),Z=setTimeout((()=>{h&&console.log("cameraOffTimer"),ie(),te.value=D.ou.now().toISO()}),1e4)}let se=(0,i.iH)(!1);function ae(e=!1){h&&console.log("onCameraHandler"),se.value=e,A.value="auto",ee.value=D.ou.now().toISO(),X.value="",te.value="",le()}function ie(){h&&console.log("offCameraHandler"),A.value="off"}function oe(){let e=new Audio("/censor-beep-01.mp3");e.play()}function ne(e){h&&console.log("onErrorHandler",e),z.value=`[${e.name}]: `,"NotAllowedError"===e.name?z.value+="you need to grant camera access permission":"NotFoundError"===e.name?z.value+="no camera on this device":"NotSupportedError"===e.name?z.value+="secure context required (HTTPS, localhost)":"NotReadableError"===e.name?z.value+="is the camera already in use?":"OverconstrainedError"===e.name?z.value+="installed cameras are not suitable":"StreamApiNotSupportedError"===e.name?z.value+="Stream API is not supported in this browser":"InsecureContextError"===e.name?z.value+="Camera access is only permitted in secure context. Use HTTPS or localhost rather than HTTP.":z.value+=e.message}return(e,l)=>{const n=(0,s.up)("q-chip"),r=(0,s.up)("q-input"),u=(0,s.up)("q-page");return(0,s.wg)(),(0,s.j4)(u,{class:"q-pa-sm"},{default:(0,s.w5)((()=>{var e,u,g,c,d,v;return[(0,s._)("div",C,[(0,s._)("div",{class:(0,a.C_)((0,i.SU)(o.$)((0,i.SU)(h),"","bg-red-2"))},[(0,s._)("div",{class:(0,a.C_)((0,i.SU)(o.$)((0,i.SU)(h),"text-h4 text-center","bg-yellow-6"))},(0,a.zw)(T.value.name),3),(0,s._)("div",{class:(0,a.C_)((0,i.SU)(o.$)((0,i.SU)(h),"text-center","bg-yellow-2"))},[(0,s.Wm)(_.Z,{value:T.value.volunteerNo,margin:0,width:1.5,height:100,format:"CODE39",lineColor:"black",elementTag:"canvas"},null,8,["value"])],2)],2),"auto"!==A.value?((0,s.wg)(),(0,s.iD)("div",{key:0,class:(0,a.C_)((0,i.SU)(o.$)((0,i.SU)(h),"text-center","bg-blue-2"))},[(0,s.Wm)(n,{clickable:"",color:"green","text-color":"white",size:"lg",onClick:l[0]||(l[0]=e=>ae())},{default:(0,s.w5)((()=>[(0,s.Uk)("自助签到")])),_:1}),(0,s.Wm)(n,{clickable:"",color:"green","text-color":"white",size:"lg",onClick:l[1]||(l[1]=e=>ae(!0))},{default:(0,s.w5)((()=>[(0,s.Uk)("工作人员 自助签到")])),_:1})],2)):(0,s.kq)("",!0),"auto"===A.value?((0,s.wg)(),(0,s.iD)("div",{key:1,class:(0,a.C_)((0,i.SU)(o.$)((0,i.SU)(h),"text-center","bg-green-2"))},[z.value?((0,s.wg)(),(0,s.iD)("div",U,(0,a.zw)(z.value),1)):(0,s.kq)("",!0),(0,s._)("div",k,[(0,s._)("div",y,["auto"===A.value?((0,s.wg)(),(0,s.j4)((0,i.SU)(m.vG),{key:0,onDetect:G,onError:ne,camera:A.value},null,8,["camera"])):(0,s.kq)("",!0)])])],2)):(0,s.kq)("",!0),Y.value?((0,s.wg)(),(0,s.iD)("div",{key:2,class:(0,a.C_)((0,i.SU)(o.$)((0,i.SU)(h),"col","bg-purple-2"))},[(0,s._)("div",{class:(0,a.C_)((0,i.SU)(o.$)((0,i.SU)(h),"row q-col-gutter-sm","bg-yellow-2"))},[(0,s.Wm)(r,{modelValue:J.value,"onUpdate:modelValue":l[2]||(l[2]=e=>J.value=e),label:"Event ID",readonly:"",class:(0,a.C_)((0,i.SU)(o.$)((0,i.SU)(h),"col-6","bg-blue-2"))},null,8,["modelValue","class"]),(0,s.Wm)(r,{modelValue:W.value,"onUpdate:modelValue":l[3]||(l[3]=e=>W.value=e),label:"Event",readonly:"",class:(0,a.C_)((0,i.SU)(o.$)((0,i.SU)(h),"col-6","bg-red-2"))},null,8,["modelValue","class"])],2),(0,s._)("div",{class:(0,a.C_)((0,i.SU)(o.$)((0,i.SU)(h),"q-col-gutter-sm","bg-yellow-2"))},[(0,s.Wm)(r,{modelValue:R.value,"onUpdate:modelValue":l[4]||(l[4]=e=>R.value=e),label:"Location",readonly:"",class:(0,a.C_)((0,i.SU)(o.$)((0,i.SU)(h),"","bg-blue-2"))},null,8,["modelValue","class"])],2),(0,s._)("div",{class:(0,a.C_)((0,i.SU)(o.$)((0,i.SU)(h),"row q-col-gutter-sm","bg-yellow-2"))},[(0,s.Wm)(r,{modelValue:M.value,"onUpdate:modelValue":l[5]||(l[5]=e=>M.value=e),label:"Latitude",readonly:"",class:(0,a.C_)((0,i.SU)(o.$)((0,i.SU)(h),"col-6","bg-blue-2"))},null,8,["modelValue","class"]),(0,s.Wm)(r,{modelValue:j.value,"onUpdate:modelValue":l[6]||(l[6]=e=>j.value=e),label:"Longitude",readonly:"",class:(0,a.C_)((0,i.SU)(o.$)((0,i.SU)(h),"col-6","bg-red-2"))},null,8,["modelValue","class"])],2),"object"===typeof t.value&&t.value?((0,s.wg)(),(0,s.iD)("div",{key:0,class:(0,a.C_)((0,i.SU)(o.$)((0,i.SU)(h),"q-col-gutter-sm","bg-yellow-2"))},[(0,s.Wm)(r,{modelValue:K.value,"onUpdate:modelValue":l[7]||(l[7]=e=>K.value=e),label:"Distance",readonly:"",class:(0,a.C_)((0,i.SU)(o.$)((0,i.SU)(h),"","bg-blue-2"))},null,8,["modelValue","class"])],2)):(0,s.kq)("",!0),(0,i.SU)(se)&&(0,i.SU)(L)?((0,s.wg)(),(0,s.iD)("div",P,[(0,s._)("div",{class:(0,a.C_)((0,i.SU)(o.$)((0,i.SU)(h),"","bg-red-2"))},[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(null===(e=(0,i.SU)(L).checkinOptions)||void 0===e?void 0:e.checkinOptions,((e,t)=>((0,s.wg)(),(0,s.j4)(b,{key:t,index:t,debug:(0,i.SU)(h),group:e},null,8,["index","debug","group"])))),128))],2),(0,i.SU)(h)?((0,s.wg)(),(0,s.iD)("div",O,[(0,s._)("pre",null,(0,a.zw)(JSON.stringify(null===(u=(0,i.SU)(L).checkinOptions)||void 0===u?void 0:u.checkinOptions,null,4)),1)])):(0,s.kq)("",!0)])):(0,s.kq)("",!0),(0,s._)("div",null,[(0,s._)("div",x,[(0,s.Wm)(n,{clickable:"",color:"green","text-color":"white",size:"lg",onClick:Q},{default:(0,s.w5)((()=>[(0,s.Uk)("确认")])),_:1}),(0,s.Wm)(n,{clickable:"",color:"red","text-color":"white",size:"lg",onClick:F},{default:(0,s.w5)((()=>[(0,s.Uk)("取消")])),_:1})])]),(0,i.SU)(h)?((0,s.wg)(),(0,s.iD)("pre",B,(0,a.zw)(Y.value),1)):(0,s.kq)("",!0)],2)):(0,s.kq)("",!0),(0,i.SU)(h)?((0,s.wg)(),(0,s.iD)("div",{key:3,class:(0,a.C_)((0,i.SU)(o.$)((0,i.SU)(h),"","bg-yellow-2"))},[(0,i.SU)(h)?((0,s.wg)(),(0,s.iD)("p",E,[(0,s.Uk)(" Last result: "),(0,s._)("b",null,(0,a.zw)(Y.value),1)])):(0,s.kq)("",!0),(0,i.SU)(h)?((0,s.wg)(),(0,s.iD)("p",q,[(0,s.Uk)(" Camera On: "),(0,s._)("b",null,(0,a.zw)(ee.value),1)])):(0,s.kq)("",!0),(0,i.SU)(h)?((0,s.wg)(),(0,s.iD)("p",N,[(0,s.Uk)(" Last Scan: "),(0,s._)("b",null,(0,a.zw)(X.value),1)])):(0,s.kq)("",!0),(0,i.SU)(h)?((0,s.wg)(),(0,s.iD)("p",V,[(0,s.Uk)(" Camera Off: "),(0,s._)("b",null,(0,a.zw)(te.value),1)])):(0,s.kq)("",!0),"object"===typeof t.value?((0,s.wg)(),(0,s.iD)("div",$,[(0,s.Uk)(" GPS Latitude: "),(0,s._)("strong",null,(0,a.zw)(null===(c=null===(g=t.value)||void 0===g?void 0:g.coords)||void 0===c?void 0:c.latitude),1)])):(0,s.kq)("",!0),"object"===typeof t.value?((0,s.wg)(),(0,s.iD)("div",H,[(0,s.Uk)(" GPS Longitude: "),(0,s._)("strong",null,(0,a.zw)(null===(v=null===(d=t.value)||void 0===d?void 0:d.coords)||void 0===v?void 0:v.longitude),1)])):(0,s.kq)("",!0)],2)):(0,s.kq)("",!0)])]})),_:1})}}});var A=l(9885),z=l(7691),Y=l(7471);const K=T,W=K;v()(T,"components",{QPage:A.Z,QChip:z.Z,QInput:Y.Z})}}]);